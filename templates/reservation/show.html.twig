{% extends 'base.html.twig' %}

{% block title %}Reservation #{{ reservation.id }} - Floryn Garden{% endblock %}
{% block page_title %}Reservation #{{ reservation.id }}{% endblock %}

{% block body %}
<div class="page-wrapper px-4 sm:px-6 lg:px-8">
  <nav class="breadcrumb">
    <a href="{{ path('admin_dashboard') }}"><i class="fas fa-home"></i></a>
    <span class="separator">/</span>
    <a href="{{ path('app_reservation_index') }}">Reservations</a>
    <span class="separator">/</span>
    <span class="current">#{{ reservation.id }}</span>
  </nav>

  <div class="page-header">
    <div class="page-header-info">
      <div class="avatar lg" style="background:linear-gradient(135deg,#f6ad55,#ed8936);"><i class="fas fa-receipt" style="font-size:20px;"></i></div>
      <div>
        <h1>Reservation #{{ reservation.id }}</h1>
        <p class="subtitle">
          {% if reservation.customer %}Placed by {{ reservation.customer.fullName }}{% endif %}
          {% if reservation.dateReserved %} on {{ reservation.dateReserved|date('F j, Y') }}{% endif %}
        </p>
      </div>
    </div>
    <div class="page-header-actions">
      <a href="{{ path('app_reservation_edit', {'id': reservation.id}) }}" class="btn btn-primary"><i class="fas fa-edit"></i> Edit</a>
      <a href="{{ path('app_reservation_index') }}" class="btn btn-outline"><i class="fas fa-arrow-left"></i> Back to List</a>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 space-y-6">
      <!-- Order Items -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-icon amber"><i class="fas fa-shopping-basket"></i></div>
          <h3>Order Items</h3>
        </div>
        <div class="section-body" style="padding:0;">
          {% if reservation.reservationDetails|length > 0 %}
            <div class="overflow-x-auto">
              <table class="min-w-full" style="border-collapse:collapse;">
                <thead>
                  <tr style="background:var(--bg);">
                    <th style="padding:10px 16px;text-align:left;font-size:11px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;">Flower</th>
                    <th style="padding:10px 16px;text-align:center;font-size:11px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;">Qty</th>
                    <th style="padding:10px 16px;text-align:right;font-size:11px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;">Price</th>
                    <th style="padding:10px 16px;text-align:right;font-size:11px;font-weight:600;color:var(--muted);text-transform:uppercase;letter-spacing:0.5px;">Subtotal</th>
                  </tr>
                </thead>
                <tbody>
                  {% for detail in reservation.reservationDetails %}
                    <tr style="border-top:1px solid var(--border);">
                      <td style="padding:12px 16px;">
                        <div class="flex items-center gap-3">
                          <div class="avatar sm" style="background:linear-gradient(135deg,#e88da0,#d65d7a);"><i class="fas fa-leaf" style="font-size:11px;"></i></div>
                          <div>
                            <div style="font-weight:600;font-size:13px;color:var(--navy);">{{ detail.flower.name }}</div>
                            <div style="font-size:11px;color:var(--muted);">{{ detail.flower.category }}</div>
                          </div>
                        </div>
                      </td>
                      <td style="padding:12px 16px;text-align:center;font-size:13px;">{{ detail.quantity }}</td>
                      <td style="padding:12px 16px;text-align:right;font-size:13px;">₱{{ detail.flower.price|number_format(2) }}</td>
                      <td style="padding:12px 16px;text-align:right;font-weight:700;font-size:13px;color:var(--navy);">₱{{ detail.subtotal|number_format(2) }}</td>
                    </tr>
                  {% endfor %}
                </tbody>
                <tfoot>
                  <tr style="border-top:2px solid var(--border);background:var(--bg);">
                    <td colspan="3" style="padding:12px 16px;text-align:right;font-weight:700;font-size:14px;">Total</td>
                    <td style="padding:12px 16px;text-align:right;font-weight:800;font-size:18px;color:var(--blue);">₱{{ reservation.totalAmount|number_format(2) }}</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          {% else %}
            <div class="empty-state" style="padding:32px 16px;">
              <div class="empty-state-icon"><i class="fas fa-box-open"></i></div>
              <h3>No items in this reservation</h3>
            </div>
          {% endif %}
        </div>
      </div>

      <!-- Customer Information -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-icon purple"><i class="fas fa-user"></i></div>
          <h3>Customer Information</h3>
        </div>
        <div class="section-body">
          {% if reservation.customer %}
            <div class="list-item" style="border:none;padding:0;">
              <div class="list-item-avatar" style="background:linear-gradient(135deg,#7c5cbf,#9b59b6);">{{ reservation.customer.fullName|first|upper }}</div>
              <div class="list-item-content">
                <div class="list-item-title">{{ reservation.customer.fullName }}</div>
                <div class="list-item-subtitle">
                  {% if reservation.customer.email %}<i class="fas fa-envelope" style="margin-right:4px;"></i>{{ reservation.customer.email }}{% endif %}
                  {% if reservation.customer.phone %} &middot; <i class="fas fa-phone" style="margin-right:4px;"></i>{{ reservation.customer.phone }}{% endif %}
                </div>
              </div>
              <div class="list-item-actions">
                <a href="{{ path('app_customer_show', {'id': reservation.customer.id}) }}" class="btn btn-ghost" style="font-size:12px;">View Profile <i class="fas fa-external-link-alt" style="margin-left:4px;"></i></a>
              </div>
            </div>
          {% else %}
            <p style="color:var(--muted);font-style:italic;">No customer assigned</p>
          {% endif %}
        </div>
      </div>

      <!-- Payment Information -->
      {% if reservation.payment %}
      <div class="section-card">
        <div class="section-header">
          <div class="section-icon green"><i class="fas fa-credit-card"></i></div>
          <h3>Payment Details</h3>
        </div>
        <div class="section-body">
          <div class="detail-grid cols-3">
            <div class="detail-item">
              <div class="detail-label">Amount Paid</div>
              <div class="detail-value large" style="color:#27ae60;">₱{{ reservation.payment.amountPaid|number_format(2) }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Payment Method</div>
              <div class="detail-value"><span class="pill {% if reservation.payment.paymentMethod == 'Credit Card' %}blue{% elseif reservation.payment.paymentMethod == 'Cash' %}green{% else %}gray{% endif %}">{{ reservation.payment.paymentMethod }}</span></div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Reference Number</div>
              <div class="detail-value mono">{{ reservation.payment.referenceNo }}</div>
            </div>
          </div>
          <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--border);">
            <a href="{{ path('app_payment_show', {'id': reservation.payment.id}) }}" style="color:var(--blue);font-size:13px;font-weight:500;">View Full Payment Details <i class="fas fa-external-link-alt" style="margin-left:4px;"></i></a>
          </div>
        </div>
      </div>
      {% endif %}
    </div>

    <div class="space-y-6">
      <!-- Status -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-icon blue"><i class="fas fa-info-circle"></i></div>
          <h3>Status</h3>
        </div>
        <div class="section-body">
          <div class="detail-grid cols-1">
            <div class="detail-item">
              <div class="detail-label">Reservation Status</div>
              <div class="detail-value">
                <span class="pill {% if reservation.reservationStatus == 'Completed' %}green{% elseif reservation.reservationStatus == 'Confirmed' %}blue{% elseif reservation.reservationStatus == 'Pending' %}yellow{% else %}red{% endif %}">
                  {% if reservation.reservationStatus == 'Completed' %}<i class="fas fa-check-circle" style="margin-right:4px;"></i>
                  {% elseif reservation.reservationStatus == 'Confirmed' %}<i class="fas fa-thumbs-up" style="margin-right:4px;"></i>
                  {% elseif reservation.reservationStatus == 'Pending' %}<i class="fas fa-clock" style="margin-right:4px;"></i>
                  {% else %}<i class="fas fa-times-circle" style="margin-right:4px;"></i>{% endif %}
                  {{ reservation.reservationStatus }}
                </span>
              </div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Payment Status</div>
              <div class="detail-value">
                <span class="pill {% if reservation.paymentStatus == 'Paid' %}green{% else %}red{% endif %}">
                  {% if reservation.paymentStatus == 'Paid' %}<i class="fas fa-check-circle" style="margin-right:4px;"></i>{% else %}<i class="fas fa-times-circle" style="margin-right:4px;"></i>{% endif %}
                  {{ reservation.paymentStatus }}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Dates -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-icon purple"><i class="fas fa-calendar-alt"></i></div>
          <h3>Dates</h3>
        </div>
        <div class="section-body">
          <div class="detail-grid cols-1">
            <div class="detail-item">
              <div class="detail-label">Date Reserved</div>
              <div class="detail-value">
                {% if reservation.dateReserved %}
                  {{ reservation.dateReserved|date('F j, Y') }}
                  <div style="font-size:12px;color:var(--muted);margin-top:2px;">{{ reservation.dateReserved|date('g:i A') }}</div>
                {% else %}<span style="color:var(--muted);font-style:italic;">Not recorded</span>{% endif %}
              </div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Pickup Date</div>
              <div class="detail-value">
                {% if reservation.pickupDate %}
                  {{ reservation.pickupDate|date('F j, Y') }}
                {% else %}<span style="color:var(--muted);font-style:italic;">Not scheduled</span>{% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-icon green"><i class="fas fa-receipt"></i></div>
          <h3>Summary</h3>
        </div>
        <div class="section-body">
          <div class="detail-grid cols-1">
            <div class="detail-item">
              <div class="detail-label">Items</div>
              <div class="detail-value">{{ reservation.reservationDetails|length }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Total Amount</div>
              <div class="detail-value large" style="color:var(--blue);">₱{{ reservation.totalAmount|number_format(2) }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Danger Zone -->
      <div class="danger-zone">
        <div class="danger-zone-header">
          <i class="fas fa-exclamation-triangle"></i>
          <div>
            <h4>Danger Zone</h4>
            <p>Permanently delete this reservation. This action cannot be undone.</p>
          </div>
        </div>
        <div class="danger-zone-body">
          {{ include('reservation/_delete_form.html.twig') }}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}