{% extends 'base.html.twig' %}

{% block title %}Activity Logs - Floryn Garden{% endblock %}
{% block page_title %}Activity Logs{% endblock %}

{% block body %}
<div class="px-4 sm:px-6 lg:px-8">
  <!-- Header -->
  <div class="sm:flex sm:items-center mb-6">
    <div class="sm:flex-auto">
      <h1 class="text-2xl font-semibold text-gray-900">Activity Logs</h1>
      <p class="mt-2 text-sm text-gray-700">Monitor all system activities, user actions, and security events in real-time.</p>
    </div>
  </div>

  <!-- Stats Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
    <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <i class="fas fa-history text-[#293855] text-2xl"></i>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-gray-500 truncate">Total Logs</dt>
              <dd class="text-lg font-medium text-gray-900">{{ logs|length }}</dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <i class="fas fa-sign-in-alt text-green-400 text-2xl"></i>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-gray-500 truncate">Login Events</dt>
              <dd class="text-lg font-medium text-gray-900">
                {% set loginCount = 0 %}
                {% for log in logs %}
                  {% if log.action == 'LOGIN' %}
                    {% set loginCount = loginCount + 1 %}
                  {% endif %}
                {% endfor %}
                {{ loginCount }}
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <i class="fas fa-edit text-blue-400 text-2xl"></i>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-gray-500 truncate">CRUD Operations</dt>
              <dd class="text-lg font-medium text-gray-900">
                {% set crudCount = 0 %}
                {% for log in logs %}
                  {% if log.action in ['CREATE', 'UPDATE', 'DELETE'] %}
                    {% set crudCount = crudCount + 1 %}
                  {% endif %}
                {% endfor %}
                {{ crudCount }}
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>

    <div class="bg-white overflow-hidden shadow rounded-lg">
      <div class="p-5">
        <div class="flex items-center">
          <div class="flex-shrink-0">
            <i class="fas fa-trash text-red-400 text-2xl"></i>
          </div>
          <div class="ml-5 w-0 flex-1">
            <dl>
              <dt class="text-sm font-medium text-gray-500 truncate">Delete Actions</dt>
              <dd class="text-lg font-medium text-gray-900">
                {% set deleteCount = 0 %}
                {% for log in logs %}
                  {% if log.action == 'DELETE' %}
                    {% set deleteCount = deleteCount + 1 %}
                  {% endif %}
                {% endfor %}
                {{ deleteCount }}
              </dd>
            </dl>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters -->
  <div class="table-card mb-6">
    <div class="px-5 py-4">
      <h3 class="text-sm font-medium mb-4 flex items-center" style="color:var(--muted);font-family:'Inter',sans-serif;">
        <i class="fas fa-filter mr-2" style="color:var(--muted);"></i>Filter Logs
      </h3>
      <form method="get" class="grid grid-cols-1 md:grid-cols-4 gap-4">
        <div>
          <label class="block text-sm font-medium mb-1" style="color:var(--navy);font-family:'Inter',sans-serif;">Username</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-user" style="color:var(--muted);"></i>
            </div>
            <input type="text" name="username" value="{{ filters.username }}" placeholder="Search by username" 
                   class="filter-select" style="width:100%;padding-left:36px;">
          </div>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1" style="color:var(--navy);font-family:'Inter',sans-serif;">Action</label>
          <select name="action" class="filter-select" style="width:100%;">
            <option value="">All Actions</option>
            <option value="LOGIN" {% if filters.action == 'LOGIN' %}selected{% endif %}>Login</option>
            <option value="LOGOUT" {% if filters.action == 'LOGOUT' %}selected{% endif %}>Logout</option>
            <option value="CREATE" {% if filters.action == 'CREATE' %}selected{% endif %}>Create</option>
            <option value="UPDATE" {% if filters.action == 'UPDATE' %}selected{% endif %}>Update</option>
            <option value="DELETE" {% if filters.action == 'DELETE' %}selected{% endif %}>Delete</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium mb-1" style="color:var(--navy);font-family:'Inter',sans-serif;">Date</label>
          <input type="date" name="date" value="{{ filters.date }}" 
                 class="filter-select" style="width:100%;">
        </div>
        <div class="flex items-end space-x-2">
          <button type="submit" class="btn-primary" style="display:inline-flex;align-items:center;gap:6px;">
            <i class="fas fa-search"></i>Filter
          </button>
          <a href="{{ path('app_activity_log_index') }}" 
             class="btn-outline" style="display:inline-flex;align-items:center;gap:6px;padding:9px 16px;border:1px solid #e4e9f0;border-radius:8px;font-size:13px;font-weight:500;color:var(--navy);background:white;text-decoration:none;transition:all 0.2s;">
            <i class="fas fa-redo"></i>Reset
          </a>
        </div>
      </form>
    </div>
  </div>

  <!-- Logs Table -->
  <div data-controller="floryn-table"
       data-floryn-table-page-size-value="25"
       data-floryn-table-sort-col-value="4"
       data-floryn-table-sort-dir-value="desc"
       data-floryn-table-no-sort-cols-value="[]"
       data-floryn-table-entity-name-value="log entries">
  <div class="table-card">
    <div class="table-card-header">
      <h3>Activity Timeline</h3>
    </div>

    <div class="fg-toolbar">
      <div class="fg-toolbar-left">
        <select data-floryn-table-target="pageSize" data-action="floryn-table#onPageSizeChange" class="fg-page-size">
          <option value="10">10</option>
          <option value="25" selected>25</option>
          <option value="50">50</option>
          <option value="-1">All</option>
        </select>
        <button type="button" class="fg-export-btn" data-action="floryn-table#exportCopy" title="Copy"><i class="fas fa-copy"></i></button>
        <button type="button" class="fg-export-btn" data-action="floryn-table#exportCsv" title="CSV"><i class="fas fa-file-csv"></i></button>
        <button type="button" class="fg-export-btn" data-action="floryn-table#exportExcel" title="Excel"><i class="fas fa-file-excel"></i></button>
        <button type="button" class="fg-export-btn" data-action="floryn-table#exportPrint" title="Print"><i class="fas fa-print"></i></button>
      </div>
      <div class="fg-toolbar-right">
        <div class="fg-search">
          <i class="fas fa-search fg-search-icon"></i>
          <input type="text" data-floryn-table-target="search" data-action="input->floryn-table#onSearch" placeholder="Search logs..." class="fg-search-input">
        </div>
      </div>
    </div>

    <div class="overflow-x-auto">
      <table class="fg-table" data-floryn-table-target="table">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">User</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Role</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Target Data</th>
            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date & Time</th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
          {% for log in logs %}
            <tr class="hover:bg-gray-50 transition">
              <td class="px-6 py-4 whitespace-nowrap">
                <div class="flex items-center">
                  <div class="flex-shrink-0 h-8 w-8">
                    <div class="h-8 w-8 rounded-full bg-[#293855] flex items-center justify-center text-white text-xs font-semibold">
                      {{ log.username|slice(0, 1)|upper }}
                    </div>
                  </div>
                  <div class="ml-3">
                    <div class="text-sm font-medium text-gray-900">{{ log.username }}</div>
                  </div>
                </div>
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                {% if 'ROLE_ADMIN' in log.role %}
                  <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-purple-100 text-purple-800">
                    <i class="fas fa-crown mr-1"></i>Admin
                  </span>
                {% else %}
                  <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                    <i class="fas fa-user-tie mr-1"></i>Staff
                  </span>
                {% endif %}
              </td>
              <td class="px-6 py-4 whitespace-nowrap">
                {% if log.action == 'LOGIN' %}
                  <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                    <i class="fas fa-sign-in-alt mr-1"></i>{{ log.action }}
                  </span>
                {% elseif log.action == 'LOGOUT' %}
                  <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                    <i class="fas fa-sign-out-alt mr-1"></i>{{ log.action }}
                  </span>
                {% elseif log.action == 'CREATE' %}
                  <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                    <i class="fas fa-plus mr-1"></i>{{ log.action }}
                  </span>
                {% elseif log.action == 'UPDATE' %}
                  <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                    <i class="fas fa-edit mr-1"></i>{{ log.action }}
                  </span>
                {% elseif log.action == 'DELETE' %}
                  <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                    <i class="fas fa-trash mr-1"></i>{{ log.action }}
                  </span>
                {% else %}
                  <span class="px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                    {{ log.action }}
                  </span>
                {% endif %}
              </td>
              <td class="px-6 py-4 text-sm text-gray-900">
                <span class="max-w-xs truncate block" title="{{ log.targetData ?? '-' }}">{{ log.targetData ?? '-' }}</span>
              </td>
              <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                <div>{{ log.createdAt|date('M d, Y') }}</div>
                <div class="text-xs text-gray-400">{{ log.createdAt|date('h:i A') }}</div>
              </td>
            </tr>
          {% else %}
            <tr>
              <td colspan="5" class="px-6 py-12 text-center text-gray-500">
                <i class="fas fa-clipboard-list text-4xl mb-3 block text-gray-300"></i>
                <p class="text-lg font-medium">No activity logs found</p>
                <p class="text-sm mt-1">Activity will appear here as users interact with the system.</p>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="fg-bottom-bar">
      <div class="fg-info" data-floryn-table-target="info"></div>
      <div class="fg-pagination" data-floryn-table-target="pagination"></div>
    </div>
  </div>
  </div>
</div>

{% endblock %}
