{% extends 'base.html.twig' %}

{% block title %}Suppliers - Floryn Garden{% endblock %}
{% block page_title %}Supplier Management{% endblock %}

{% block body %}
<div class="page-wrapper px-4 sm:px-6 lg:px-8">
  <div class="page-header">
    <div class="page-header-info">
      <h1><i class="fas fa-truck" style="color:#4265d6;font-size:22px;"></i> Supplier Network</h1>
      <p class="subtitle">Manage your flower suppliers, delivery schedules, and business relationships.</p>
    </div>
    <div class="page-header-actions">
      <a href="{{ path('app_supplier_new') }}" class="btn btn-primary"><i class="fas fa-truck-loading"></i> Add New Supplier</a>
    </div>
  </div>

  <div class="stat-grid">
    <div class="stat-card">
      <div class="stat-icon blue"><i class="fas fa-truck"></i></div>
      <div class="stat-content">
        <div class="stat-label">Total Suppliers</div>
        <div class="stat-value">{{ suppliers|length }}</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon green"><i class="fas fa-seedling"></i></div>
      <div class="stat-content">
        <div class="stat-label">Active Flowers</div>
        <div class="stat-value">{% set totalFlowers = 0 %}{% for supplier in suppliers %}{% set totalFlowers = totalFlowers + supplier.flowers|length %}{% endfor %}{{ totalFlowers }}</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon purple"><i class="fas fa-calendar-plus"></i></div>
      <div class="stat-content">
        <div class="stat-label">Added This Month</div>
        <div class="stat-value">{% set thisMonth = 0 %}{% for supplier in suppliers %}{% if supplier.dateAdded and supplier.dateAdded|date('Y-m') == date()|date('Y-m') %}{% set thisMonth = thisMonth + 1 %}{% endif %}{% endfor %}{{ thisMonth }}</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon amber"><i class="fas fa-clock"></i></div>
      <div class="stat-content">
        <div class="stat-label">Daily Deliveries</div>
        <div class="stat-value">{% set dailyDeliveries = 0 %}{% for supplier in suppliers %}{% if supplier.deliverySchedule and 'daily' in supplier.deliverySchedule|lower %}{% set dailyDeliveries = dailyDeliveries + 1 %}{% endif %}{% endfor %}{{ dailyDeliveries }}</div>
      </div>
    </div>
  </div>

  {% if suppliers is not empty %}
  <div class="table-card"
       data-controller="floryn-table"
       data-floryn-table-page-size-value="10"
       data-floryn-table-sort-col-value="0"
       data-floryn-table-sort-dir-value="asc"
       data-floryn-table-no-sort-cols-value="[5]"
       data-floryn-table-entity-name-value="suppliers">

    <div class="table-card-header"><h3>All Suppliers</h3></div>

    <div class="fg-toolbar">
      <div class="fg-toolbar-left">
        <select class="fg-page-size" data-floryn-table-target="pageSize" data-action="floryn-table#onPageSizeChange">
          <option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="-1">All</option>
        </select>
        <div class="fg-export-buttons">
          <button type="button" class="fg-export-btn" data-action="floryn-table#exportCopy"><i class="fas fa-copy"></i> Copy</button>
          <button type="button" class="fg-export-btn" data-action="floryn-table#exportCsv"><i class="fas fa-file-csv"></i> CSV</button>
          <button type="button" class="fg-export-btn" data-action="floryn-table#exportExcel"><i class="fas fa-file-excel"></i> Excel</button>
          <button type="button" class="fg-export-btn" data-action="floryn-table#exportPrint"><i class="fas fa-print"></i> Print</button>
        </div>
      </div>
      <div class="fg-toolbar-right">
        <div class="fg-search-wrap">
          <i class="fas fa-search fg-search-icon"></i>
          <input type="text" class="fg-search" placeholder="Search suppliers..." data-floryn-table-target="search" data-action="input->floryn-table#onSearch">
        </div>
      </div>
    </div>

    <div class="overflow-x-auto">
      <table class="fg-table min-w-full" style="width:100%" data-floryn-table-target="table">
        <thead>
          <tr><th>Supplier</th><th>Contact Info</th><th>Address</th><th>Delivery Schedule</th><th>Flowers</th><th>Actions</th></tr>
        </thead>
        <tbody>
          {% for supplier in suppliers %}
            <tr>
              <td class="px-4 py-3">
                <div class="flex items-center gap-3">
                  <div class="avatar sm" style="background:linear-gradient(135deg,#3b82f6,#1d4ed8);"><i class="fas fa-industry" style="font-size:12px;"></i></div>
                  <div>
                    <div style="font-weight:600;color:var(--navy);font-size:13px;">{{ supplier.supplierName }}</div>
                    <div style="font-size:11px;color:var(--muted);">{{ supplier.contactPerson }}</div>
                  </div>
                </div>
              </td>
              <td class="px-4 py-3" style="font-size:13px;">
                <div><i class="fas fa-phone" style="color:var(--muted);margin-right:4px;font-size:10px;"></i> <a href="tel:{{ supplier.phone }}" style="color:var(--blue);">{{ supplier.phone }}</a></div>
                <div><i class="fas fa-envelope" style="color:var(--muted);margin-right:4px;font-size:10px;"></i> <a href="mailto:{{ supplier.email }}" style="color:var(--blue);">{{ supplier.email }}</a></div>
              </td>
              <td class="px-4 py-3" style="font-size:13px;max-width:180px;">{{ supplier.address|slice(0, 50) }}{% if supplier.address|length > 50 %}...{% endif %}</td>
              <td class="px-4 py-3">
                <span class="pill {% if 'daily' in supplier.deliverySchedule|lower %}green{% elseif 'weekly' in supplier.deliverySchedule|lower %}blue{% else %}gray{% endif %}">{{ supplier.deliverySchedule }}</span>
              </td>
              <td class="px-4 py-3">
                {% if supplier.flowers|length > 0 %}
                  <span class="pill navy">{{ supplier.flowers|length }} flowers</span>
                {% else %}
                  <span class="pill gray">No flowers</span>
                {% endif %}
              </td>
              <td class="px-4 py-3 text-right">
                <div class="row-actions">
                  <a href="{{ path('app_supplier_show', {'id': supplier.id}) }}" class="row-action-btn" title="View"><i class="fas fa-eye"></i></a>
                  <a href="{{ path('app_supplier_edit', {'id': supplier.id}) }}" class="row-action-btn" title="Edit"><i class="fas fa-edit"></i></a>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="fg-bottom-bar">
      <div class="fg-info" data-floryn-table-target="info"></div>
      <div class="fg-pagination" data-floryn-table-target="pagination"></div>
    </div>

  {% else %}
    <div class="section-card">
      <div class="empty-state">
        <div class="empty-state-icon"><i class="fas fa-truck"></i></div>
        <h3>No suppliers found</h3>
        <p>Build your supply chain by adding your first supplier.</p>
        <a href="{{ path('app_supplier_new') }}" class="btn btn-primary"><i class="fas fa-truck-loading"></i> Add Your First Supplier</a>
      </div>
    </div>
  {% endif %}
  </div>
</div>
{% endblock %}