{% extends 'base.html.twig' %}

{% block title %}{{ customer.fullName }} - Floryn Garden{% endblock %}
{% block page_title %}{{ customer.fullName }}{% endblock %}

{% block body %}
<div class="page-wrapper px-4 sm:px-6 lg:px-8">
  <nav class="breadcrumb">
    <a href="{{ path('admin_dashboard') }}"><i class="fas fa-home"></i></a>
    <span class="separator">/</span>
    <a href="{{ path('app_customer_index') }}">Customers</a>
    <span class="separator">/</span>
    <span class="current">{{ customer.fullName }}</span>
  </nav>

  <div class="page-header">
    <div class="page-header-info">
      <div class="avatar lg" style="background:linear-gradient(135deg,#7c5cbf,#9b59b6);">{{ customer.fullName|first|upper }}</div>
      <div>
        <h1>{{ customer.fullName }}</h1>
        <p class="subtitle">Customer profile and reservation history</p>
      </div>
    </div>
    <div class="page-header-actions">
      <a href="{{ path('app_customer_edit', {'id': customer.id}) }}" class="btn btn-primary"><i class="fas fa-edit"></i> Edit Customer</a>
      <a href="{{ path('app_customer_index') }}" class="btn btn-outline"><i class="fas fa-arrow-left"></i> Back to List</a>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 space-y-6">
      <!-- Contact Information -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-icon purple"><i class="fas fa-address-card"></i></div>
          <h3>Contact Information</h3>
        </div>
        <div class="section-body">
          <div class="detail-grid cols-2">
            <div class="detail-item">
              <div class="detail-label">Full Name</div>
              <div class="detail-value large">{{ customer.fullName }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Customer ID</div>
              <div class="detail-value mono">#{{ customer.id }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Phone Number</div>
              <div class="detail-value">
                <i class="fas fa-phone" style="color:var(--muted);margin-right:6px;font-size:12px;"></i>
                {% if customer.phone %}<a href="tel:{{ customer.phone }}" style="color:var(--blue);">{{ customer.phone }}</a>{% else %}<span style="color:var(--muted);font-style:italic;">Not provided</span>{% endif %}
              </div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Email Address</div>
              <div class="detail-value">
                <i class="fas fa-envelope" style="color:var(--muted);margin-right:6px;font-size:12px;"></i>
                {% if customer.email %}<a href="mailto:{{ customer.email }}" style="color:var(--blue);">{{ customer.email }}</a>{% else %}<span style="color:var(--muted);font-style:italic;">Not provided</span>{% endif %}
              </div>
            </div>
            <div class="detail-item full">
              <div class="detail-label">Address</div>
              <div class="detail-value">
                <i class="fas fa-map-marker-alt" style="color:var(--muted);margin-right:6px;font-size:12px;"></i>
                {{ customer.address ?? 'No address on file' }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Reservation History -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-icon amber"><i class="fas fa-calendar-alt"></i></div>
          <h3>Reservation History</h3>
          <span class="section-badge">{{ customer.reservations|length }}</span>
        </div>
        <div class="section-body">
          {% if customer.reservations|length > 0 %}
            {% for reservation in customer.reservations %}
              <div class="list-item">
                <div class="list-item-avatar" style="background:linear-gradient(135deg,#f6ad55,#ed8936);"><i class="fas fa-receipt"></i></div>
                <div class="list-item-content">
                  <div class="list-item-title">Reservation #{{ reservation.id }}</div>
                  <div class="list-item-subtitle">{{ reservation.dateReserved ? reservation.dateReserved|date('M j, Y') : 'No date' }}</div>
                </div>
                <div class="list-item-actions">
                  <span class="pill {% if reservation.reservationStatus == 'Completed' %}green{% elseif reservation.reservationStatus == 'Confirmed' %}blue{% elseif reservation.reservationStatus == 'Pending' %}yellow{% else %}red{% endif %}">{{ reservation.reservationStatus }}</span>
                  <span style="font-weight:700;color:var(--navy);margin:0 8px;">₱{{ reservation.totalAmount|number_format(2) }}</span>
                  <a href="{{ path('app_reservation_show', {'id': reservation.id}) }}" class="btn btn-ghost" style="padding:4px 8px;font-size:12px;"><i class="fas fa-external-link-alt"></i></a>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <div class="empty-state" style="padding:32px 16px;">
              <div class="empty-state-icon"><i class="fas fa-calendar-times"></i></div>
              <h3>No reservations yet</h3>
              <p>This customer hasn't made any reservations</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>

    <div class="space-y-6">
      <!-- Registration -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-icon blue"><i class="fas fa-calendar-check"></i></div>
          <h3>Registration</h3>
        </div>
        <div class="section-body">
          <div class="detail-grid cols-1">
            <div class="detail-item">
              <div class="detail-label">Date Registered</div>
              <div class="detail-value">
                {% if customer.dateRegistered %}
                  {{ customer.dateRegistered|date('F j, Y') }}
                  <div style="font-size:12px;color:var(--muted);margin-top:2px;">{{ customer.dateRegistered|date('g:i A') }}</div>
                {% else %}
                  <span style="color:var(--muted);font-style:italic;">Not recorded</span>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="section-card">
        <div class="section-header">
          <div class="section-icon green"><i class="fas fa-chart-bar"></i></div>
          <h3>Quick Stats</h3>
        </div>
        <div class="section-body">
          <div class="detail-grid cols-1">
            <div class="detail-item">
              <div class="detail-label">Total Reservations</div>
              <div class="detail-value large">{{ customer.reservations|length }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Total Spent</div>
              <div class="detail-value large" style="color:var(--blue);">
                ₱{% set totalSpent = 0 %}{% for reservation in customer.reservations %}{% set totalSpent = totalSpent + reservation.totalAmount %}{% endfor %}{{ totalSpent|number_format(2) }}
              </div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Notifications Sent</div>
              <div class="detail-value large">{{ customer.notificationLogs|length }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Danger Zone -->
      <div class="danger-zone">
        <div class="danger-zone-header">
          <i class="fas fa-exclamation-triangle"></i>
          <div>
            <h4>Danger Zone</h4>
            <p>Permanently delete this customer. This action cannot be undone.</p>
          </div>
        </div>
        <div class="danger-zone-body">
          {{ include('customer/_delete_form.html.twig') }}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}