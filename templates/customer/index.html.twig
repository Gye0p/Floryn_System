{% extends 'base.html.twig' %}

{% block title %}Customers - Floryn Garden{% endblock %}
{% block page_title %}Customer Management{% endblock %}

{% block body %}
<div class="page-wrapper px-4 sm:px-6 lg:px-8">
  <div class="page-header">
    <div class="page-header-info">
      <h1><i class="fas fa-users" style="color:#4265d6;font-size:22px;"></i> Customer Database</h1>
      <p class="subtitle">Manage your customer relationships and contact information.</p>
    </div>
    <div class="page-header-actions">
      <a href="{{ path('app_customer_new') }}" class="btn btn-primary"><i class="fas fa-user-plus"></i> Add New Customer</a>
    </div>
  </div>

  <div class="stat-grid" style="grid-template-columns:repeat(3,1fr);">
    <div class="stat-card">
      <div class="stat-icon blue"><i class="fas fa-users"></i></div>
      <div class="stat-content">
        <div class="stat-label">Total Customers</div>
        <div class="stat-value">{{ customers|length }}</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon green"><i class="fas fa-calendar-plus"></i></div>
      <div class="stat-content">
        <div class="stat-label">New This Month</div>
        <div class="stat-value">{% set thisMonth = 0 %}{% for customer in customers %}{% if customer.dateRegistered and customer.dateRegistered|date('Y-m') == date()|date('Y-m') %}{% set thisMonth = thisMonth + 1 %}{% endif %}{% endfor %}{{ thisMonth }}</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon purple"><i class="fas fa-shopping-bag"></i></div>
      <div class="stat-content">
        <div class="stat-label">With Orders</div>
        <div class="stat-value">{% set withOrders = 0 %}{% for customer in customers %}{% if customer.reservations|length > 0 %}{% set withOrders = withOrders + 1 %}{% endif %}{% endfor %}{{ withOrders }}</div>
      </div>
    </div>
  </div>

  {% if customers is not empty %}
  <div class="table-card"
       data-controller="floryn-table"
       data-floryn-table-page-size-value="10"
       data-floryn-table-sort-col-value="0"
       data-floryn-table-sort-dir-value="asc"
       data-floryn-table-no-sort-cols-value="[5]"
       data-floryn-table-entity-name-value="customers">

    <div class="table-card-header"><h3>All Customers</h3></div>

    <div class="fg-toolbar">
      <div class="fg-toolbar-left">
        <select class="fg-page-size" data-floryn-table-target="pageSize" data-action="floryn-table#onPageSizeChange">
          <option value="10">10</option><option value="25">25</option><option value="50">50</option><option value="-1">All</option>
        </select>
        <div class="fg-export-buttons">
          <button type="button" class="fg-export-btn" data-action="floryn-table#exportCopy"><i class="fas fa-copy"></i> Copy</button>
          <button type="button" class="fg-export-btn" data-action="floryn-table#exportCsv"><i class="fas fa-file-csv"></i> CSV</button>
          <button type="button" class="fg-export-btn" data-action="floryn-table#exportExcel"><i class="fas fa-file-excel"></i> Excel</button>
          <button type="button" class="fg-export-btn" data-action="floryn-table#exportPrint"><i class="fas fa-print"></i> Print</button>
        </div>
      </div>
      <div class="fg-toolbar-right">
        <div class="fg-search-wrap">
          <i class="fas fa-search fg-search-icon"></i>
          <input type="text" class="fg-search" placeholder="Search customers..." data-floryn-table-target="search" data-action="input->floryn-table#onSearch">
        </div>
      </div>
    </div>

    <div class="overflow-x-auto">
      <table class="fg-table min-w-full" style="width:100%" data-floryn-table-target="table">
        <thead>
          <tr><th>Customer</th><th>Contact Info</th><th>Address</th><th>Registered</th><th>Orders</th><th>Actions</th></tr>
        </thead>
        <tbody>
          {% for customer in customers %}
            <tr>
              <td class="px-4 py-3">
                <div class="flex items-center gap-3">
                  <div class="avatar sm" style="background:linear-gradient(135deg,#7c5cbf,#9b59b6);font-size:12px;">{{ customer.fullName|first|upper }}</div>
                  <div>
                    <div style="font-weight:600;color:var(--navy);font-size:13px;">{{ customer.fullName }}</div>
                    <div style="font-size:11px;color:var(--muted);">ID: {{ customer.id }}</div>
                  </div>
                </div>
              </td>
              <td class="px-4 py-3">
                <div style="font-size:13px;">
                  <div><i class="fas fa-phone" style="color:var(--muted);margin-right:4px;font-size:10px;"></i> <a href="tel:{{ customer.phone }}" style="color:var(--blue);">{{ customer.phone }}</a></div>
                  <div><i class="fas fa-envelope" style="color:var(--muted);margin-right:4px;font-size:10px;"></i> <a href="mailto:{{ customer.email }}" style="color:var(--blue);">{{ customer.email }}</a></div>
                </div>
              </td>
              <td class="px-4 py-3" style="font-size:13px;max-width:200px;">{{ customer.address }}</td>
              <td class="px-4 py-3" style="font-size:13px;">
                {% if customer.dateRegistered %}
                  {{ customer.dateRegistered|date('M j, Y') }}
                  <div style="font-size:11px;color:var(--muted);">{{ customer.dateRegistered|date('g:i A') }}</div>
                {% else %}<span style="color:var(--muted);">Not recorded</span>{% endif %}
              </td>
              <td class="px-4 py-3">
                {% if customer.reservations|length > 0 %}
                  <span class="pill blue">{{ customer.reservations|length }} orders</span>
                {% else %}
                  <span class="pill gray">No orders</span>
                {% endif %}
              </td>
              <td class="px-4 py-3 text-right">
                <div class="row-actions">
                  <a href="{{ path('app_customer_show', {'id': customer.id}) }}" class="row-action-btn" title="View"><i class="fas fa-eye"></i></a>
                  <a href="{{ path('app_customer_edit', {'id': customer.id}) }}" class="row-action-btn" title="Edit"><i class="fas fa-edit"></i></a>
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="fg-bottom-bar">
      <div class="fg-info" data-floryn-table-target="info"></div>
      <div class="fg-pagination" data-floryn-table-target="pagination"></div>
    </div>

  {% else %}
    <div class="section-card">
      <div class="empty-state">
        <div class="empty-state-icon"><i class="fas fa-users"></i></div>
        <h3>No customers found</h3>
        <p>Get started by adding your first customer to the database.</p>
        <a href="{{ path('app_customer_new') }}" class="btn btn-primary"><i class="fas fa-user-plus"></i> Add Your First Customer</a>
      </div>
    </div>
  {% endif %}
  </div>
</div>
{% endblock %}