{% extends 'base.html.twig' %}

{% block title %}Payment #{{ payment.id }} - Floryn Garden{% endblock %}
{% block page_title %}Payment Details{% endblock %}

{% block body %}
<div class="page-wrapper px-4 sm:px-6 lg:px-8">
  <nav class="breadcrumb">
    <a href="{{ path('admin_dashboard') }}"><i class="fas fa-home"></i></a>
    <span class="separator">/</span>
    <a href="{{ path('app_payment_index') }}">Payments</a>
    <span class="separator">/</span>
    <span class="current">Payment #{{ payment.id }}</span>
  </nav>

  <div class="page-header">
    <div class="page-header-info">
      <div class="avatar lg" style="background:linear-gradient(135deg,#22c55e,#16a34a);"><i class="fas fa-dollar-sign" style="font-size:20px;"></i></div>
      <div>
        <h1>Payment #{{ payment.id }}</h1>
        <p class="subtitle">Transaction recorded on {{ payment.paymentDate ? payment.paymentDate|date('F j, Y \\a\\t g:i A') : 'Unknown date' }}</p>
      </div>
    </div>
    <div class="page-header-actions">
      <a href="{{ path('app_payment_edit', {'id': payment.id}) }}" class="btn btn-primary"><i class="fas fa-edit"></i> Edit Payment</a>
      <a href="{{ path('app_payment_index') }}" class="btn btn-outline"><i class="fas fa-arrow-left"></i> Back to List</a>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 space-y-6">

      <div class="section-card">
        <div class="section-header">
          <div class="section-icon green"><i class="fas fa-credit-card"></i></div>
          <h3>Payment Information</h3>
        </div>
        <div class="section-body">
          <div class="detail-grid cols-2">
            <div class="detail-item">
              <div class="detail-label">Payment ID</div>
              <div class="detail-value" style="font-weight:700;">#{{ payment.id }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Amount Paid</div>
              <div class="detail-value large" style="color:#22c55e;">₱{{ payment.amountPaid|number_format(2) }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Payment Date</div>
              <div class="detail-value">
                {% if payment.paymentDate %}
                  <div><i class="fas fa-calendar" style="color:var(--muted);margin-right:6px;"></i>{{ payment.paymentDate|date('F j, Y') }}</div>
                  <div style="font-size:12px;color:var(--muted);margin-top:4px;"><i class="fas fa-clock" style="margin-right:6px;"></i>{{ payment.paymentDate|date('g:i A') }}</div>
                {% else %}<span style="color:var(--muted);font-style:italic;">No date specified</span>{% endif %}
              </div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Status</div>
              <div class="detail-value">
                <span class="pill {% if payment.status == 'Paid' or payment.status == 'Completed' %}green{% elseif payment.status == 'Pending' %}yellow{% elseif payment.status == 'Processing' %}blue{% else %}red{% endif %}">
                  {% if payment.status == 'Paid' or payment.status == 'Completed' %}<i class="fas fa-check-circle" style="margin-right:4px;"></i>
                  {% elseif payment.status == 'Pending' %}<i class="fas fa-clock" style="margin-right:4px;"></i>
                  {% elseif payment.status == 'Processing' %}<i class="fas fa-spinner" style="margin-right:4px;"></i>
                  {% else %}<i class="fas fa-times-circle" style="margin-right:4px;"></i>{% endif %}
                  {{ payment.status }}
                </span>
              </div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Payment Method</div>
              <div class="detail-value">
                <span class="pill {% if payment.paymentMethod == 'Credit Card' %}blue{% elseif payment.paymentMethod == 'Cash' %}green{% elseif payment.paymentMethod == 'Bank Transfer' %}navy{% else %}gray{% endif %}">
                  {% if payment.paymentMethod == 'Credit Card' %}<i class="fas fa-credit-card" style="margin-right:4px;"></i>
                  {% elseif payment.paymentMethod == 'Cash' %}<i class="fas fa-money-bill-wave" style="margin-right:4px;"></i>
                  {% elseif payment.paymentMethod == 'Bank Transfer' %}<i class="fas fa-university" style="margin-right:4px;"></i>
                  {% else %}<i class="fas fa-wallet" style="margin-right:4px;"></i>{% endif %}
                  {{ payment.paymentMethod }}
                </span>
              </div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Reference Number</div>
              <div class="detail-value mono">{{ payment.referenceNo }}</div>
            </div>
          </div>
        </div>
      </div>

      {% if payment.reservation %}
      <div class="section-card">
        <div class="section-header">
          <div class="section-icon purple"><i class="fas fa-receipt"></i></div>
          <h3>Related Reservation</h3>
        </div>
        <div class="section-body" style="padding:0;">
          <div class="list-item" style="border:none;">
            <div class="list-item-avatar" style="background:linear-gradient(135deg,#9b59b6,#8e44ad);"><i class="fas fa-receipt"></i></div>
            <div class="list-item-content">
              <div class="list-item-title">Reservation #{{ payment.reservation.id }}</div>
              <div class="list-item-subtitle">{{ payment.reservation.customer.fullName }}</div>
            </div>
            <div class="list-item-actions" style="flex-direction:column;align-items:flex-end;gap:4px;">
              <div style="font-size:18px;font-weight:700;color:var(--navy);">₱{{ payment.reservation.totalAmount|number_format(2) }}</div>
              <a href="{{ path('app_reservation_show', {'id': payment.reservation.id}) }}" class="btn btn-ghost" style="padding:4px 10px;font-size:12px;"><i class="fas fa-external-link-alt"></i> View</a>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

    </div>

    <div class="space-y-6">

      <div class="section-card">
        <div class="section-header">
          <div class="section-icon blue"><i class="fas fa-chart-bar"></i></div>
          <h3>Payment Summary</h3>
        </div>
        <div class="section-body">
          <div class="detail-grid cols-1">
            <div class="detail-item">
              <div class="detail-label">Transaction ID</div>
              <div class="detail-value" style="font-weight:600;">#{{ payment.id }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Amount Paid</div>
              <div class="detail-value large" style="color:#22c55e;">₱{{ payment.amountPaid|number_format(2) }}</div>
            </div>
            {% if payment.reservation %}
            <div class="detail-item">
              <div class="detail-label">Order Total</div>
              <div class="detail-value" style="font-weight:600;">₱{{ payment.reservation.totalAmount|number_format(2) }}</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Remaining Balance</div>
              <div class="detail-value" style="font-weight:600;color:{% if (payment.reservation.totalAmount - payment.amountPaid) == 0 %}#22c55e{% else %}#ef4444{% endif %};">
                ₱{{ (payment.reservation.totalAmount - payment.amountPaid)|abs|number_format(2) }}
                {% if (payment.reservation.totalAmount - payment.amountPaid) == 0 %}<i class="fas fa-check-circle" style="margin-left:6px;"></i>{% endif %}
              </div>
            </div>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="section-card">
        <div class="section-header">
          <div class="section-icon" style="background:var(--navy);color:white;"><i class="fas fa-bolt"></i></div>
          <h3>Quick Actions</h3>
        </div>
        <div class="section-body" style="display:flex;flex-direction:column;gap:10px;">
          <a href="{{ path('app_payment_edit', {'id': payment.id}) }}" class="btn btn-primary" style="width:100%;"><i class="fas fa-edit"></i> Edit Payment</a>
          {% if payment.reservation %}
          <a href="{{ path('app_reservation_show', {'id': payment.reservation.id}) }}" class="btn btn-outline" style="width:100%;"><i class="fas fa-receipt"></i> View Reservation</a>
          {% endif %}
        </div>
      </div>

      <div class="danger-zone">
        <div class="danger-zone-header">
          <i class="fas fa-exclamation-triangle"></i>
          <h3>Danger Zone</h3>
        </div>
        <div class="danger-zone-body">
          <p>Permanently delete this payment record. This action cannot be undone.</p>
          {{ include('payment/_delete_form.html.twig') }}
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}